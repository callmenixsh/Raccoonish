<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/raccoonish.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Raccoonish</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <script type="module">
(function() {
  const SITE_ID = 'Raccoonish';
  const SITE_URL = 'https://raccoonish.netlify.app/';
  const COOLDOWN_MS = 2000;

  const createVisitorId = () => {
    if (window.crypto && typeof window.crypto.randomUUID === 'function') {
      return window.crypto.randomUUID();
    }
    return 'v_' + Date.now() + '_' + Math.random().toString(36).slice(2);
  };

  const getVisitorId = () => {
    try {
      const key = 'visteria_vid_' + SITE_ID;
      const existing = localStorage.getItem(key);
      if (existing) return existing;
      const created = createVisitorId();
      localStorage.setItem(key, created);
      return created;
    } catch {
      return createVisitorId();
    }
  };
  
  const lastTracked = sessionStorage.getItem('visteria_last_' + SITE_ID);
  const now = Date.now();
  
  if (lastTracked && now - parseInt(lastTracked) < COOLDOWN_MS) return;
  
  if (document.hidden) return;
  
  sessionStorage.setItem('visteria_last_' + SITE_ID, now.toString());
  
  fetch('https://visteria.vercel.app/api/visits/track', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      siteId: SITE_ID,
      siteUrl: SITE_URL,
      visitorId: getVisitorId(),
      url: location.href,
      referrer: document.referrer,
      userAgent: navigator.userAgent,
      visitedAt: new Date().toISOString()
    }),
    keepalive: true
  }).catch(() => {});
})();
</script>
  </body>
</html>
